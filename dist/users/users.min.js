"use strict";const LIST_USERS_URL="/users",NEW_USERS_URL="/users/new";angular.module("EventPlanner.users",["ngRoute"]).config(["$routeProvider",function(e){e.when("/users",{templateUrl:"users/users.html",controller:"UsersCtrl"}),e.when("/users/new",{templateUrl:"users/newuser.html",controller:"NewUsersCtrl"}),e.when("/users/edit/:email",{templateUrl:"users/newuser.html",controller:"NewUsersCtrl"})}]).factory("userService",[function(){var e=this;e.LIST_USERS_URL="#/users",e.NEW_USERS_URL="#/users/new",e.USERS_KEY="USERS";var r=function(e,r,t,s,a){this.firstName=e,this.lastName=r,this.name=this.getName(),this.email=t,this.password=s,this.details=a};if(r.fromObject=function(e){return new r(e.firstName,e.lastName,e.email,e.password,e.details)},e.User=r,r.prototype.getName=function(){return this.firstName+" "+this.lastName},r.prototype.updateFromUser=function(e){this.firstName=e.firstName,this.lastName=e.lastName,this.name=this.getName(),this.email=e.email,this.details=e.details},r.formats={date:"DD/MM/YYYY"},r.prototype.getBirthdayString=function(){return this.details.birthday?moment(this.details.birthday).format(r.formats.date):void 0},e.storage=window.localStorage,e.storage){if(e.storage.key(e.USERS_KEY)){var t=JSON.parse(e.storage.getItem(e.USERS_KEY));t&&(e.users=t.map(function(e){return r.fromObject(e)}))}}else console.warn("No localStorage available");return e.users||(e.users=[new r("Narayana","Garner","n.garner@example.com"),new r("Anita","Gros","a.gros@example.com"),new r("Some-guy","withalongalastaname","s.withalongalastaname@example.com")]),e.updateUsers=function(){e.storage&&e.storage.setItem(e.USERS_KEY,JSON.stringify(e.users))},e.getAllUsers=function(){return e.users},e.getUserByEmail=function(r){return e.users.find(function(e){return e.email===r})},e.addUser=function(r){e.users.push(r),e.updateUsers()},e.removeUser=function(r){var t=e.users.findIndex(function(e){return e.email===r});-1!=t&&(e.users.splice(t,1),e.updateUsers())},e}]).controller("UsersCtrl",["$scope","userService",function(e,r){e.users=r.users,e.deleteUser=r.removeUser}]).controller("NewUsersCtrl",["$scope","userService","$window","$routeParams",function(e,r,t,s){if(e.isEdit=function(){return!!s.email},e.isEdit()){var a=r.getUserByEmail(s.email);a?(e.user=angular.copy(a),a.details&&a.details.birthday&&(e.user.details.birthday=moment(a.details.birthday).toDate())):t.location.href=r.LIST_USERS_URL}else e.user=null;e.formats=r.User.formats,e.verifyPassword=function(){function r(e){var r=new RegExp(e),s=r.test(t);return s}var t=e.userForm.password.$viewValue||"",s=e.userForm.cpassword.$viewValue||"",a={match:function(){return t==s&&t&&s},minLength:function(){return t.length>=6},maxLength:function(){return t.length<=100},symbol:function(){return r("[!@#$%^&*]")},number:function(){return r("[0-9]")},lowercase:function(){return r("[a-z]")},uppercase:function(){return r("[A-Z]")}},n=function(){var e=Object.keys(a).map(function(e){return a[e]()?"":e}).filter(function(e){return""!==e});return e},i=function(r,t){r.forEach(function(r){"match"===r?e.userForm.cpassword.$setValidity(r,t):e.userForm.password.$setValidity(r,t)})},o=n();if(0===o.length)i(Object.keys(a));else{var u=Object.keys(a).filter(function(e){return!o.includes(e)});i(u,!0),i(o,!1)}},e.submitForm=function(){if(e.isEdit()){var a=angular.copy(e.user);a.details&&a.details.birthday&&(a.details.birthday=a.details.birthday.getTime()),r.getUserByEmail(s.email).updateFromUser(a),r.updateUsers()}else{var n=(new Hashes.SHA1).hex(e.user.password);r.addUser(new r.User(e.user.firstName,e.user.lastName,e.user.email,n))}t.location.href=r.LIST_USERS_URL}}]);